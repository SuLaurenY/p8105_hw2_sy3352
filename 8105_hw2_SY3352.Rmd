---
title: "p8105_hw2_SY3352"
author: "Su Yan"
date: "2025-10-01"
output: github_document
---

```{r setup, include = FALSE}
library(tidyverse)
library(readxl)
library(janitor)
```

## Problem 1
```{r}
pols_df = read_csv("data/pols-month.csv") |> 
  separate(mon, into = c("year","month","day"), sep = "-") |> 
  mutate(year = as.integer(year), month = as.integer(month)) |> 
  mutate(month = month.name[month]) |> 
  mutate(president = if_else(prez_gop == 1, "gop","dem")) |> 
  select(-prez_dem, -prez_gop,-day)
```

```{r}
snp_df = read_csv("data/snp.csv") |> 
  mutate(date = mdy(date)) |> 
  mutate(year = year(date), month = month(date), day = day(date)) |> 
  mutate(year = as.integer(year), month = month.name[month]) |> 
  mutate(year = if_else(year > 2024, year - 100, year)) |> 
  select(-date, -day) |> 
  relocate(year, month) |> 
  arrange(year, match(month, month.name))
```

```{r}
unemp_df = read_csv("data/unemployment.csv") |> 
  pivot_longer(cols = Jan:Dec,
               names_to = "month",
               values_to = "unemployment_rate") |> 
  mutate(month = recode(month,
                        Jan = "January", Feb = "February", 
                        Mar = "March", Apr = "April", 
                        May = "May", Jun = "June",
                        Jul = "July", Aug = "August", 
                        Sep = "September", Oct = "October",
                        Nov = "November", Dec = "December")) |> 
  rename(year = Year) 
```

```{r}
merge_df = pols_df |> 
  left_join(snp_df, by = c("year","month")) |> 
  left_join(unemp_df, by = c("year","month"))
```

The `pols_df` data set contains data from 1947 to 2015 of number of politicians(including the president) in each political party in the US by month. The `snp_df` contains data of closing values of the S&P stock index from 1950 to 2015 by month. The `unemp_df` data set contains data of unemployment rate from 1948 to 2015 by month. The merged `merge_df` data set has `r nrow(merge_df)` rows and `r ncol(merge_df)` columns of data, which covered `r min(merge_df$year)` to `r max(merge_df$year)` of political party, S&P index closing value and employment information. Some of the key variables in **`merge_df`** are `year` `month` `president` `closing` and `unemployment_rate`.

## Problem 2
```{r}
mtw_df = read_excel("data/202509 Trash Wheel Collection Data.xlsx",
                    sheet = "Mr. Trash Wheel",
                    skip = 1) |> 
  janitor::clean_names() |> 
  filter(!(dumpster == "na")) |> 
  mutate(sports_balls = as.integer(round(sports_balls))) |> 
  select(-x15, -x16)
```

```{r}
ptw_df = read_excel("data/202509 Trash Wheel Collection Data.xlsx",
                    sheet = "Professor Trash Wheel",
                    skip = 1) |> 
  janitor::clean_names() |> 
  filter(!(dumpster == "na")) 
```

```{r}
gtw_df = read_excel("data/202509 Trash Wheel Collection Data.xlsx",
                    sheet = "Gwynns Falls Trash Wheel",
                    skip = 1) |> 
  janitor::clean_names() |> 
  filter(!(dumpster == "na")) 
```

```{r}
mtw_df = mutate(mtw_df, 
                wheel_name = "Mr. Trash Wheel", 
                year = as.integer(year))
ptw_df = mutate(ptw_df, 
                wheel_name = "Professor Trash Wheel", 
                year = as.integer(year))
gtw_df = mutate(gtw_df, 
                wheel_name = "Gwynns Falls Trash Wheel", 
                year = as.integer(year))
combined_df = bind_rows(mtw_df, ptw_df, gtw_df) 
```

By combining the data from the three data sheets, we get the `combined_df` data set, which has `r nrow(combined_df)` rows of observations and `r ncol(combined_df)` columns of data. The dataset give information by each dumpster from the three wheels: **Mr. Trash Wheel**, **Professor Trash Wheel**, and **Gwynns Falls Trash Wheel**. Some of the key variables  are `weight_tons` `plastic_bottles` `cigarette_butts` `glass_bottles` and `homes_powered`. The total weight of trash collected by Professor Trash Wheel is `r sum(combined_df$weight_tons[combined_df$wheel_name == "Professor Trash Wheel"])` tons, and the total number of cigarette butts collected by Gwynnda in June of 2022 is `r as.integer(sum(combined_df$cigarette_butts[combined_df$wheel_name == "Gwynns Falls Trash Wheel" & combined_df$month == "June" & combined_df$year == 2022]))`.

## Problem 3
```{r}
rent_df = read_csv("data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv") |> 
  pivot_longer(cols = 10:125,
               names_to = "date",
               values_to = "rent_rate") |> 
  janitor::clean_names() |> 
  select(-region_type, -state_name, -state, -city, -metro, -region_id, -size_rank) |> 
  rename(zip_code = region_name)
```

```{r}
zip_df = read_csv("data/Zip Codes.csv") |> 
  janitor::clean_names() |> 
  select(-county_code, -county_fips, -state_fips, -file_date, -county)
```

```{r}
rent_neigh_joint_df = rent_df |> 
  left_join(zip_df, by = c("zip_code")) |> 
  relocate(last_col(), .after = 2)
```

The result tidy dataset `rent_neigh_joint_df` has `r nrow(rent_neigh_joint_df)` rows of observations and `r ncol(rent_neigh_joint_df)` columns of data. It contains information of rent by month throughout 2015 - 2024 in NYC with variables of `zip_code` `county_name` `neighborhood` `date` and `rent rate`. There are `r length(unique(rent_neigh_joint_df$zip_code))` unique zip codes and `r length(unique(rent_neigh_joint_df$neighborhood))` unique neighborhoods.

```{r}
zip_not_app_df = filter(zip_df, !(zip_code %in% rent_df$zip_code)) 
```
There are total `r length(unique(zip_not_app_df$zip_code))` zip codes that appear in the ZIP code dataset but not in the Zillow Rental Price dataset. These zip codes are: `r paste(zip_not_app_df$zip_code, collapse = ", ")`.  

The reason that these zip codes are not included in the Zillow database could be that there are commercial zip codes with no residential significance, or retired zip codes. It can also be that the zip code represents an area with very small populations which does not provide enough rental data. For example the zip code **10249** in this list is located in New York, NY, and is a PO-box zip code which does not have residential housing significance.